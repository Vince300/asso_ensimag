# = require jquery
# = require jquery_ujs
# = require turbolinks
# = require bootstrap
# = require epiceditor
# = require moment
# = require moment/fr
# = require bootstrap-datetimepicker
# = require bootstrap-colorpicker

$ ->
  init_editors = ->
    $('.epiceditor textarea').each ->
      # Add a link to the markdown cheatsheet
      adiv = $('<p />').addClass('text-right')
      adiv.append($('<a />').text("Markdown cheatsheet")
          .attr('href', "https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet")
          .attr('target', '_blank'))
      $item = $(this)
      $item.parent().append(adiv)
      # Wrap the element in a div, wrapped in a div
      pdiv = $('<div />').addClass('epiceditor-container')
      $item.wrap(pdiv)
      $item.parent().wrap($('<div />').addClass('epiceditor-parent'))
      # Build the editor
      dv = $item.parent()[0]

      editor = new EpicEditor(
        container: dv,
        autogrow: true,
        clientSideStorage: false,
        theme:
          preview: '<%= asset_path("epiceditor/preview.css") %>',
          editor: '<%= asset_path("epiceditor/editor.css") %>')

      editor.load()
      editor.reflow()
    $('.form-datetime').each ->
      $this = $(this)
      v = moment($this.find('input').val())
      $this.datetimepicker
        locale: 'fr'
        sideBySide: true
        showTodayButton: true
        allowInputToggle: true
        showClear: true
      $this.data("DateTimePicker").date(v)
    $('.colorpicker-editor').each ->
      $(this).colorpicker
        align: 'left'
        format: 'hex'
    $('.btn-file :file').on 'change', (event) ->
      input = $(this)
      txtInput = input.parents('.input-group').find(':text')
      txtInput.val input.val()
    $('.btn-clear').click (event) ->
      btn = $(this)
      prnt = btn.parents('.input-group')
      input = prnt.find('.btn-file :file')
      txtInput = prnt.find(':text')
      input.val null
      txtInput.val null

  $(document).ready(init_editors)
  $(document).on('page:load', init_editors)
